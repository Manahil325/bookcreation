"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[5440],{123(e,n,s){s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>m,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"python-agents-rclpy","title":"Python Agents with rclpy","description":"Introduction","source":"@site/docs/python-agents-rclpy.md","sourceDirName":".","slug":"/python-agents-rclpy","permalink":"/docs/python-agents-rclpy","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/python-agents-rclpy.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Python Agents with rclpy"},"sidebar":"tutorialSidebar","previous":{"title":"ROS 2 Fundamentals","permalink":"/docs/ros2-fundamentals"},"next":{"title":"Humanoid Modeling with URDF","permalink":"/docs/humanoid-modeling-urdf"}}');var r=s(4848),i=s(8453);const o={sidebar_position:2,title:"Python Agents with rclpy"},a="Python Agents with rclpy: Connecting AI to Robot Controllers",l={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Setting Up rclpy",id:"setting-up-rclpy",level:2},{value:"Creating ROS 2 Nodes in Python",id:"creating-ros-2-nodes-in-python",level:2},{value:"Publishing Sensor Data",id:"publishing-sensor-data",level:2},{value:"Subscribing to Robot Data",id:"subscribing-to-robot-data",level:2},{value:"Creating Services",id:"creating-services",level:2},{value:"Implementing AI Agents with ROS 2",id:"implementing-ai-agents-with-ros-2",level:2},{value:"Connecting AI Libraries",id:"connecting-ai-libraries",level:2},{value:"Best Practices for Python Agents",id:"best-practices-for-python-agents",level:2},{value:"Error Handling",id:"error-handling",level:3},{value:"Resource Management",id:"resource-management",level:3},{value:"Threading Considerations",id:"threading-considerations",level:3},{value:"Summary",id:"summary",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"python-agents-with-rclpy-connecting-ai-to-robot-controllers",children:"Python Agents with rclpy: Connecting AI to Robot Controllers"})}),"\n",(0,r.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,r.jsx)(n.p,{children:"Python is one of the most popular languages for AI development, and rclpy is the Python client library for ROS 2. This chapter explains how to create Python agents that can connect to robot controllers, publish sensor data, and receive control commands within the ROS 2 ecosystem. This connection forms a crucial part of the robotic nervous system that links AI agents with physical robot controllers."}),"\n",(0,r.jsx)(n.h2,{id:"setting-up-rclpy",children:"Setting Up rclpy"}),"\n",(0,r.jsx)(n.p,{children:"To get started with rclpy, you'll need to install the ROS 2 Python client library. If you're using a standard ROS 2 installation, rclpy should already be available. Otherwise, you can install it using:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pip install rclpy\n"})}),"\n",(0,r.jsx)(n.h2,{id:"creating-ros-2-nodes-in-python",children:"Creating ROS 2 Nodes in Python"}),"\n",(0,r.jsx)(n.p,{children:"The foundation of any Python agent in ROS 2 is a node. Here's the basic structure:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\n\nclass MyPythonAgent(Node):\n    def __init__(self):\n        super().__init__('python_agent')\n        # Initialize publishers, subscribers, services, etc.\n        self.get_logger().info('Python Agent initialized')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = MyPythonAgent()\n    rclpy.spin(node)\n    node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h2,{id:"publishing-sensor-data",children:"Publishing Sensor Data"}),"\n",(0,r.jsx)(n.p,{children:"One of the most common tasks for AI agents is to publish sensor data that other nodes can use. Here's how to create a publisher:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import Image, LaserScan\nfrom std_msgs.msg import Float32\n\nclass SensorPublisher(Node):\n    def __init__(self):\n        super().__init__('sensor_publisher')\n\n        # Create publishers for different sensor types\n        self.image_publisher = self.create_publisher(Image, 'camera/image_raw', 10)\n        self.laser_publisher = self.create_publisher(LaserScan, 'scan', 10)\n        self.battery_publisher = self.create_publisher(Float32, 'battery_level', 10)\n\n        # Create a timer to periodically publish data\n        self.timer = self.create_timer(0.1, self.publish_sensor_data)  # 10Hz\n\n        self.get_logger().info('Sensor Publisher initialized')\n\n    def publish_sensor_data(self):\n        # Simulate sensor data publishing\n        battery_msg = Float32()\n        battery_msg.data = 85.5  # Simulated battery level\n        self.battery_publisher.publish(battery_msg)\n\n        self.get_logger().info(f'Published battery level: {battery_msg.data}%')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = SensorPublisher()\n    rclpy.spin(node)\n    node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h2,{id:"subscribing-to-robot-data",children:"Subscribing to Robot Data"}),"\n",(0,r.jsx)(n.p,{children:"Python agents often need to subscribe to data from other nodes to make intelligent decisions:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import JointState\nfrom geometry_msgs.msg import Twist\n\nclass DataSubscriber(Node):\n    def __init__(self):\n        super().__init__('data_subscriber')\n\n        # Subscribe to joint states\n        self.joint_subscription = self.create_subscription(\n            JointState,\n            'joint_states',\n            self.joint_callback,\n            10)\n\n        # Subscribe to velocity commands\n        self.cmd_subscription = self.create_subscription(\n            Twist,\n            'cmd_vel',\n            self.velocity_callback,\n            10)\n\n        self.get_logger().info('Data Subscriber initialized')\n\n    def joint_callback(self, msg):\n        # Process joint state data\n        for i, name in enumerate(msg.name):\n            position = msg.position[i]\n            velocity = msg.velocity[i]\n            effort = msg.effort[i]\n\n            # Implement AI logic based on joint data\n            if 'head' in name and abs(position) > 1.5:\n                self.get_logger().warn(f'{name} near position limit: {position:.2f}')\n\n    def velocity_callback(self, msg):\n        # Process velocity commands\n        linear_x = msg.linear.x\n        angular_z = msg.angular.z\n        self.get_logger().info(f'Received velocity command: linear={linear_x:.2f}, angular={angular_z:.2f}')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = DataSubscriber()\n    rclpy.spin(node)\n    node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h2,{id:"creating-services",children:"Creating Services"}),"\n",(0,r.jsx)(n.p,{children:"Python agents can also provide services for other nodes to call:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom std_srvs.srv import SetBool\nfrom example_interfaces.srv import AddTwoInts\n\nclass ServiceServer(Node):\n    def __init__(self):\n        super().__init__('service_server')\n\n        # Create a service to enable/disable the agent\n        self.enable_service = self.create_service(\n            SetBool,\n            'enable_agent',\n            self.enable_callback)\n\n        # Create a service to perform calculations\n        self.calc_service = self.create_service(\n            AddTwoInts,\n            'add_two_ints',\n            self.add_callback)\n\n        self.agent_enabled = True\n        self.get_logger().info('Service Server initialized')\n\n    def enable_callback(self, request, response):\n        self.agent_enabled = request.data\n        response.success = True\n        response.message = f'Agent {\"enabled\" if self.agent_enabled else \"disabled\"}'\n        self.get_logger().info(response.message)\n        return response\n\n    def add_callback(self, request, response):\n        response.sum = request.a + request.b\n        self.get_logger().info(f'{request.a} + {request.b} = {response.sum}')\n        return response\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = ServiceServer()\n    rclpy.spin(node)\n    node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h2,{id:"implementing-ai-agents-with-ros-2",children:"Implementing AI Agents with ROS 2"}),"\n",(0,r.jsx)(n.p,{children:"Here's a more complete example showing how to implement an AI agent that processes sensor data and sends control commands:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import LaserScan\nfrom geometry_msgs.msg import Twist\nfrom std_msgs.msg import Bool\nimport numpy as np\n\nclass AINavigatorAgent(Node):\n    def __init__(self):\n        super().__init__('ai_navigator_agent')\n\n        # Publishers\n        self.cmd_publisher = self.create_publisher(Twist, 'cmd_vel', 10)\n        self.emergency_publisher = self.create_publisher(Bool, 'emergency_stop', 10)\n\n        # Subscribers\n        self.scan_subscription = self.create_subscription(\n            LaserScan,\n            'scan',\n            self.scan_callback,\n            10)\n\n        # Timer for AI decision making\n        self.ai_timer = self.create_timer(0.2, self.ai_decision_loop)  # 5Hz\n\n        # Agent state\n        self.laser_data = None\n        self.obstacle_detected = False\n        self.get_logger().info('AI Navigator Agent initialized')\n\n    def scan_callback(self, msg):\n        # Store laser scan data for AI processing\n        self.laser_data = np.array(msg.ranges)\n        # Filter out invalid ranges (inf or nan)\n        self.laser_data = self.laser_data[np.isfinite(self.laser_data)]\n\n        # Check for obstacles\n        if len(self.laser_data) > 0:\n            min_distance = np.min(self.laser_data)\n            self.obstacle_detected = min_distance < 0.5  # 50cm threshold\n\n    def ai_decision_loop(self):\n        if self.laser_data is None:\n            return\n\n        cmd_msg = Twist()\n\n        if self.obstacle_detected:\n            # Stop and turn to avoid obstacle\n            cmd_msg.linear.x = 0.0\n            cmd_msg.angular.z = 0.5  # Turn right\n            self.get_logger().warn('Obstacle detected! Turning...')\n        else:\n            # Move forward\n            cmd_msg.linear.x = 0.3  # 0.3 m/s forward\n            cmd_msg.angular.z = 0.0\n\n        # Publish command\n        self.cmd_publisher.publish(cmd_msg)\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = AINavigatorAgent()\n    rclpy.spin(node)\n    node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h2,{id:"connecting-ai-libraries",children:"Connecting AI Libraries"}),"\n",(0,r.jsx)(n.p,{children:"Python's rich AI ecosystem can be easily integrated with ROS 2. Here's an example using TensorFlow for object detection:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import Image\nfrom vision_msgs.msg import Detection2D, Detection2DArray\nfrom cv_bridge import CvBridge\nimport cv2\nimport tensorflow as tf\n\nclass AIVisionAgent(Node):\n    def __init__(self):\n        super().__init__('ai_vision_agent')\n\n        # Publishers and subscribers\n        self.image_subscription = self.create_subscription(\n            Image,\n            'camera/image_raw',\n            self.image_callback,\n            10)\n\n        self.detection_publisher = self.create_publisher(\n            Detection2DArray,\n            'object_detections',\n            10)\n\n        # CV bridge to convert ROS images to OpenCV format\n        self.cv_bridge = CvBridge()\n\n        # Load pre-trained model (simplified example)\n        # self.model = tf.keras.models.load_model('path/to/model')\n\n        self.get_logger().info('AI Vision Agent initialized')\n\n    def image_callback(self, msg):\n        try:\n            # Convert ROS image to OpenCV format\n            cv_image = self.cv_bridge.imgmsg_to_cv2(msg, desired_encoding='bgr8')\n\n            # Process image with AI model (simplified)\n            # detections = self.model.predict(cv_image)\n\n            # For this example, we'll simulate detection\n            detections = self.simulate_detection(cv_image)\n\n            # Publish detections\n            detection_msg = Detection2DArray()\n            detection_msg.header = msg.header\n            detection_msg.detections = detections\n            self.detection_publisher.publish(detection_msg)\n\n        except Exception as e:\n            self.get_logger().error(f'Error processing image: {e}')\n\n    def simulate_detection(self, image):\n        # Simulated detection for example purposes\n        # In real implementation, this would use actual AI model\n        height, width = image.shape[:2]\n\n        # Create a simulated detection\n        detection = Detection2D()\n        detection.bbox.center.x = width / 2\n        detection.bbox.center.y = height / 2\n        detection.bbox.size_x = 100\n        detection.bbox.size_y = 100\n\n        return [detection]\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = AIVisionAgent()\n    rclpy.spin(node)\n    node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h2,{id:"best-practices-for-python-agents",children:"Best Practices for Python Agents"}),"\n",(0,r.jsx)(n.h3,{id:"error-handling",children:"Error Handling"}),"\n",(0,r.jsx)(n.p,{children:"Always implement proper error handling in your Python agents:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"try:\n    # ROS operations\n    result = some_ros_operation()\nexcept Exception as e:\n    self.get_logger().error(f'Operation failed: {e}')\n    # Implement fallback behavior\n"})}),"\n",(0,r.jsx)(n.h3,{id:"resource-management",children:"Resource Management"}),"\n",(0,r.jsx)(n.p,{children:"Properly manage resources and clean up when the node is destroyed:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"def destroy_node(self):\n    # Clean up any resources before destroying the node\n    if hasattr(self, 'camera'):\n        self.camera.release()\n    super().destroy_node()\n"})}),"\n",(0,r.jsx)(n.h3,{id:"threading-considerations",children:"Threading Considerations"}),"\n",(0,r.jsx)(n.p,{children:"Be aware that rclpy is not thread-safe by default. Use the multi-threaded executor when needed:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"executor = rclpy.executors.MultiThreadedExecutor()\nexecutor.add_node(node)\nexecutor.spin()\n"})}),"\n",(0,r.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsx)(n.p,{children:"Python agents with rclpy provide a powerful way to connect AI systems with robot controllers. By understanding how to create nodes, publishers, subscribers, and services, you can build sophisticated agents that process sensor data, make intelligent decisions, and control robot behavior. The integration with Python's rich AI ecosystem makes it an excellent choice for implementing the intelligent components of a robotic nervous system."}),"\n",(0,r.jsx)(n.p,{children:"In the next chapter, we'll explore how to model humanoid robots using URDF (Unified Robot Description Format) and integrate these models with ROS 2."})]})}function m(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>o,x:()=>a});var t=s(6540);const r={},i=t.createContext(r);function o(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);